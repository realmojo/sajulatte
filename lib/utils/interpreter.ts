/**
 * 사주 정보를 바탕으로 프리미엄급 운세 해석을 제공합니다.
 */
export interface FortuneInterpretation {
  summary: string;
  love: string;
  marriage: string;
  money: string;
  work: string;
  health: string;
}

export function interpretSaju(
  ilgan: string,
  distributions: any,
  sipsinList: string[],
  shinsalList: string[],
  gender: 'male' | 'female' = 'male'
): FortuneInterpretation {
  // =================================================================
  // 1. 성향 분석 (나의 본질과 사회적 가면)
  // =================================================================
  let character = '';

  // (1.1) 일간별 심층 분석
  switch (ilgan) {
    case '甲':
      character =
        "당신은 하늘을 향해 곧게 뻗은 '대나무' 혹은 '거목'입니다. 굽히느니 부러지겠다는 강직한 자존심의 소유자이며, 남 밑에서 간섭받는 것을 죽기보다 싫어합니다. 리더십이 탁월하고 추진력이 있어 항상 무리의 우두머리가 되기를 자처합니다. 시작하는 힘은 타의 추종을 불허하지만, 뒷심이 부족할 수 있으니 마무리에 신경 쓴다면 대성할 그릇입니다.";
      break;
    case '乙':
      character =
        "당신은 끈질긴 생명력을 자랑하는 '덩굴 식물'이나 '꽃'입니다. 어떤 척박한 환경에서도 유연하게 적응하며, 바람이 불면 몸을 낮출 줄 아는 처세술의 달인입니다. 겉으로는 부드럽고 여려 보이지만, 내면에는 칼 같은 냉철함과 실속을 챙기는 계산적인 면모가 숨어 있습니다.";
      break;
    case '丙':
      character =
        "당신은 세상을 환하게 비추는 '태양'입니다. 숨김없이 솔직하고 정열적이며, 예의와 격식을 중요하게 생각합니다. 당신이 있는 곳은 항상 활기가 넘치고 웃음이 끊이지 않습니다. 다만, 너무 뜨거운 열정은 때로 주변 사람들을 지치게 하거나, 감정 기복이 얼굴에 그대로 드러나 손해를 볼 수 있습니다.";
      break;
    case '丁':
      character =
        "당신은 어둠을 은은하게 밝히는 '촛불'이나 '별빛'입니다. 섬세하고 감수성이 풍부하며, 타인을 위해 자신을 태워 희생하는 헌신적인 면모가 있습니다. 겉으로는 조용해 보이지만, 마음속에는 누구보다 뜨거운 열정과 집요함을 품고 있어 한번 폭발하면 걷잡을 수 없습니다.";
      break;
    case '戊':
      character =
        "당신은 모든 생명을 포용하는 '거대한 산'입니다. 묵직한 존재감으로 주변 사람들에게 신뢰를 주며, 말과 행동이 진중합니다. 중간에서 편을 가르지 않고 중재하는 능력이 탁월합니다. 그러나 한번 고집을 피우면 아무도 꺾을 수 없는 불통의 아이콘이 되기도 하니 유연함이 필요합니다.";
      break;
    case '己':
      character =
        "당신은 작물을 길러내는 '비옥한 정원'입니다. 다정다감하고 현실적이며, 사람을 키우고 교육하는 데 남다른 재능이 있습니다. 자기주장이 강하기보다는 조화와 안정을 추구하며, 실속 없는 명분보다는 내 손에 쥐어지는 이익을 중요하게 생각하는 실리파입니다.";
      break;
    case '庚':
      character =
        "당신은 제련되지 않은 거친 '원석'이나 '무쇠'입니다. 의리를 목숨처럼 여기며, 한번 맺은 인연은 끝까지 지키려 노력합니다. 결단력과 통솔력이 뛰어나 혁명가적 기질을 가지고 있습니다. 다만, 너무 직설적인 화법으로 본의 아니게 상대방에게 상처를 줄 수 있으니 언행을 부드럽게 가다듬을 필요가 있습니다.";
      break;
    case '辛':
      character =
        "당신은 예리하게 세공된 반짝이는 '보석'입니다. 깔끔하고 섬세하며, 남들이 보지 못하는 미세한 부분까지 캐치해내는 통찰력이 있습니다. 자존심이 매우 강하고 예민하여, 작은 비판에도 상처를 잘 받습니다. 차가워 보이지만 내 사람에게는 한없이 따뜻한 반전 매력의 소유자입니다.";
      break;
    case '壬':
      character =
        "당신은 유유히 흐르는 '큰 강'이나 '바다'입니다. 지혜롭고 총명하며, 어떤 그릇에도 담길 수 있는 유연함을 가졌습니다. 스케일이 크고 포용력이 있어 많은 사람들이 따릅니다. 하지만 물 속을 알 수 없듯이, 당신의 진짜 속마음은 아무도 모를 때가 많아 '음흉하다'는 오해를 사기도 합니다.";
      break;
    case '癸':
      character =
        "당신은 만물을 적시는 '봄비'나 '시냇물'입니다. 조용하고 차분하며, 나서기보다는 뒤에서 묵묵히 상황을 주시하고 계획하는 참모 역할을 선호합니다. 겉은 여려 보여도 내면에는 치밀한 계산과 전략이 숨어 있어, 결코 만만하게 볼 수 없는 지략가입니다.";
      break;
  }

  // (1.2) 사회적 가면과 내면의 갈등 (십성 + 오행)
  if (sipsinList.includes('상관') && sipsinList.includes('정관')) {
    character +=
      "\n\n[내면의 갈등] 당신 안에는 '자유로운 영혼(상관)'과 '권위적인 보수성(정관)'이 공존하고 있습니다. 늘 일탈을 꿈꾸면서도 막상 타인의 시선과 체면 때문에 주저하는 모습이 있군요. 이 모순된 에너지를 예술이나 창작으로 승화시킨다면 독보적인 매력이 될 것입니다.";
  } else if (
    sipsinList.includes('식신') &&
    !sipsinList.includes('편인') &&
    !sipsinList.includes('정인')
  ) {
    character +=
      "\n\n[행동파] '생각은 짧게, 행동은 빠르게'가 당신의 모토입니다. 머리로 계산하기 전에 몸이 먼저 움직이는 실행력의 화신이지만, 때로는 무모한 도전으로 체력을 소진할 수 있습니다. 행동하기 전에 10분만 더 고민하는 습관이 당신을 완벽하게 만듭니다.";
  } else if (sipsinList.includes('편인')) {
    character +=
      "\n\n[철학자] 남들이 보지 않는 이면의 세계에 관심이 많습니다. 촉이 남다르고 직관력이 뛰어나 '돗자리 깔라'는 소리를 듣기도 합니다. 가끔 4차원적인 매력을 발산하지만, 혼자만의 공상에 빠져 현실 감각을 잃지 않도록 주의하세요.";
  }

  // =================================================================
  // 2. 금전운 (돈의 흐름, 투자 성향, 리스크)
  // =================================================================
  let moneyLuck = '';
  const hasPyeonjae = sipsinList.includes('편재');
  const hasJeongjae = sipsinList.includes('정재');

  // (2.1) 돈을 버는 그릇의 크기와 형태
  if (hasPyeonjae) {
    moneyLuck =
      "당신은 월급 봉투에 만족할 수 없는 '사업가적 큰 그릇'을 가지고 태어났습니다. 작은 돈을 아끼기보다는, 큰돈을 굴리고 투자하여 자산을 불리는 데 탁월한 감각이 있습니다.\n\n[투자 스타일] 안전한 적금보다는 주식, 코인, 부동산 경매 등 하이 리스크 하이 리턴(High Risk, High Return) 투자를 선호하며, 실제로 동물적인 감각으로 큰 수익을 낼 확률이 높습니다. 유동 자산 운용에 능합니다.";
  } else if (hasJeongjae) {
    moneyLuck =
      "당신은 티끌 모아 태산을 만드는 '성실한 자산가'입니다. 땀 흘려 번 정당한 대가만을 원하며, 투기나 도박에는 관심이 없습니다. 꼼꼼한 가계부 작성과 계획적인 소비가 당신의 무기입니다.\n\n[투자 스타일] 원금이 보장되는 예적금, 안정적인 우량주, 임대 수익이 나오는 부동산 등 '안전 제일' 투자가 맞습니다. 당신의 부는 느리지만 확실하게 우상향할 것입니다.";
  } else {
    moneyLuck =
      "당신은 돈을 쫓아가면 도망가는 사주입니다. 하지만 당신의 '전문성'과 '명예'를 높이면 재물은 그림자처럼 자연스럽게 따라옵니다. 돈보다는 자신의 브랜드를 키우는 데 집중하세요.\n\n[솔루션] 현금을 가지고 있으면 자꾸 쓸 일이 생깁니다. 돈이 생기는 즉시 묶여있는 문서(땅, 건물, 장기 보험)로 바꾸는 것이 돈을 지키는 유일한 비결입니다.";
  }

  // (2.2) 돈이 새는 구멍 막기 (Wake-up Call)
  const bigeopCount = sipsinList.filter((s) => s === '비견' || s === '겁재').length;
  if (bigeopCount >= 2) {
    moneyLuck +=
      '\n\n⚠️ [주의] 주변에 도둑이 많습니다! 귀가 얇아 친구나 지인의 투자 권유에 넘어갔다가는 뼈저린 후회를 하게 됩니다. 돈 거래는 부모 자식 간에도 하지 말아야 하며, 동업보다는 독자 노선이 훨씬 유리합니다. 내가 부자인 것을 절대 남에게 알리지 마세요.';
  } else if (sipsinList.includes('상관') && !hasJeongjae && !hasPyeonjae) {
    moneyLuck +=
      '\n\n⚠️ [주의] 기분파 지출이 심각합니다. 스트레스를 쇼핑으로 풀거나, 남에게 보여주기 위한 과시적 소비를 줄여야 합니다. 신용카드보다는 체크카드를 사용하고, 강제 저축 시스템을 만드세요.';
  }

  // =================================================================
  // 3. 연애운 (연애 패턴, 치명적 약점, 솔루션)
  // =================================================================
  let loveLuck = '';

  if (shinsalList.includes('도화') || shinsalList.includes('홍염')) {
    loveLuck =
      '[매력 분석] 가만히 있어도 페로몬을 내뿜는 치명적인 매력의 소유자입니다. 이성들이 당신의 눈빛이나 분위기에 홀려 다가옵니다. 인기가 권력이 되는 삶을 살 수 있습니다.\n\n[연애 패턴] 금방 뜨거워졌다가 금방 식을 수 있습니다. 오는 사람 막지 않고 가는 사람 잡지 않는 쿨한 태도가 오히려 상대방을 애타게 만듭니다. 하지만 진정한 사랑을 찾기 위해서는 화려한 외면보다는 내면의 대화에 집중해야 합니다.';
  } else if (sipsinList.includes('식신') || sipsinList.includes('상관')) {
    loveLuck =
      "[매력 분석] 사랑하는 사람에게는 간도 쓸개도 빼주는 '헌신적인 사랑꾼'입니다. 상대를 웃게 만들기 위해 온갖 이벤트를 준비하는 당신의 모습은 감동 그 자체입니다.\n\n[주의점] 나의 과도한 관심과 챙김이 상대에게는 집착이나 구속으로 느껴질 수 있습니다. '엄마(아빠)'처럼 챙겨주려 하지 말고, 때로는 연인으로서 적당한 거리감을 유지하는 '밀당'이 필요합니다.";
  } else {
    loveLuck =
      "[매력 분석] 가볍지 않은 진중함과 신뢰감이 당신의 무기입니다. 첫눈에 반하는 불같은 사랑보다는, 알면 알수록 진국인 '볼매(볼수록 매력)' 스타일입니다.\n\n[솔루션] 표현이 서툴러 상대가 당신의 마음을 오해할 수 있습니다. 좋으면 좋다고, 싫으면 싫다고 말로 표현하는 연습을 하세요. 작은 선물이나 손 편지가 큰 효과를 발휘합니다.";
  }

  // =================================================================
  // 4. 결혼/배우자운 (상세 배우자 분석, 결혼 생활 예보)
  // =================================================================
  let marriageLuck = '';
  const isMale = gender === 'male';

  if (isMale) {
    if (hasJeongjae) {
      marriageLuck =
        "[배우자] 당신의 아내는 알뜰하고 생활력이 강한 '현모양처'입니다. 당신의 흩어진 재산을 모아주고, 가정의 기틀을 단단하게 잡아줄 귀인입니다.\n\n[결혼 생활 예보] 아내의 잔소리가 늘어날 수 있지만, 그것은 망해가는 집안도 일으키는 쓴 약입니다. 아내에게 경제권을 맡기고 용돈을 타 쓰는 것이 오히려 마음 편하고 재산을 불리는 지름길임을 명심하세요. 평온하고 안정적인 노후가 보장됩니다.";
    } else if (hasPyeonjae) {
      marriageLuck =
        "[배우자] 능력 있고 활동적인 '커리어 우먼' 스타일의 아내를 맞이합니다. 집안일만 하는 전업주부보다는 사회적으로 인정받는 아내와 인연이 깊습니다.\n\n[결혼 생활 예보] 아내의 기가 세거나 밖으로 도는 일이 많아 당신이 외로움을 느낄 수 있습니다. 아내를 구속하려 하지 말고 그녀의 사회적 성공을 진심으로 응원해 주는 '외조'를 할 때, 아내 또한 당신을 존경하고 따르게 됩니다.";
    } else {
      marriageLuck =
        "[배우자] 친구처럼 편안하고 격식 없는 배우자와 인연이 있습니다. 국적이나 나이 차이를 뛰어넘는 파격적인 만남이 예상됩니다.\n\n[결혼 생활 예보] '부부니까 무조건 같이'라는 고정관념을 버리세요. 각자의 취미와 사생활을 철저히 존중하는 '독립적인 부부' 형태가 가장 이상적입니다. 주말 부부나 기러기 아빠 생활도 나쁘지 않습니다.";
    }
  } else {
    const hasGwan = sipsinList.includes('정관') || sipsinList.includes('편관');
    const hasSik = sipsinList.includes('식신') || sipsinList.includes('상관');

    if (hasGwan) {
      marriageLuck =
        "[배우자] 보수적이지만 책임감 하나는 끝내주는 '남편감'을 만납니다. 공직자나 대기업 등 안정된 직장의 남자와 인연이 깊습니다.\n\n[결혼 생활 예보] 남편이 다소 고지식하고 권위적일 수 있어 답답함을 느낄 수 있습니다. 하지만 가정의 경제적 안정과 사회적 체면을 위해 묵묵히 일하는 남편의 노고를 인정해 주세요. '칭찬' 한마디면 남편은 당신을 여왕처럼 모실 것입니다.";
    } else if (hasSik && !hasGwan) {
      marriageLuck =
        "[배우자] 모성애를 자극하는 연하남이나, 자유로운 영혼을 가진 예술가 스타일과 강하게 끌립니다. 당신이 챙겨주고 리드할 수 있는 남자가 들어옵니다.\n\n[결혼 생활 예보] 남편의 경제력에 의존하기보다는 당신이 주도적으로 가계를 꾸려나갈 확률이 높습니다. '내가 먹여 살린다'는 마음을 먹으면 편하지만, 기대려 하면 싸움이 잦아집니다. 남편을 자식처럼 생각하고 칭찬해 주면 가정의 평화가 찾아옵니다.";
    } else {
      marriageLuck =
        "[배우자] 권위 의식이 없고 대화가 잘 통하는 '소울메이트' 같은 남자를 만나야 합니다.\n\n[결혼 생활 예보] 결혼이라는 제도에 얽매이기보다는 동거 같은 형태, 혹은 딩크족 등 자유로운 형태의 결합이 더 잘 맞습니다. 시댁과의 갈등을 피하기 위해 분가하거나 거리를 두는 것이 현명합니다.";
    }
  }

  // =================================================================
  // 5. 직업운 (리더십 스타일, 위기 관리, 적성)
  // =================================================================
  let workLuck = '';

  // (5.1) 직업 적성 및 스타일
  if (sipsinList.includes('편관') || sipsinList.includes('정관')) {
    workLuck =
      "[리더십] 당신은 조직을 체계적으로 관리하고 이끄는 '카리스마 리더'형입니다. 공과 사가 분명하고 원칙을 준수하여 윗사람의 신임과 아랫사람의 존경을 동시에 받습니다.\n\n[추천 분야] 공무원, 공기업, 대기업 관리직, 군인/경찰, 법조계, 의료계 등 **위계질서가 명확하고 명예가 보장되는 곳**에서 승승장구합니다.";
  } else if (sipsinList.includes('식신') || sipsinList.includes('상관')) {
    workLuck =
      "[리더십] 권위로 누르기보다는 실력과 성과로 증명하는 '실무형 리더'입니다. 창의적인 아이디어로 위기를 돌파하는 해결사 능력이 탁월합니다.\n\n[추천 분야] 마케팅, 광고, 디자인, 유튜버, 강사, 요식업, 예체능 등 **자신의 재능과 끼를 마음껏 발산할 수 있는 자유로운 환경**이 천직입니다. 틀에 박힌 사무직은 당신을 병들게 합니다.";
  } else if (sipsinList.includes('편인') || sipsinList.includes('정인')) {
    workLuck =
      "[리더십] 깊은 통찰력과 지식으로 방향을 제시하는 '전략가형 리더'입니다. 직접 뛰기보다는 뒤에서 판을 짜고 기획하는 참모 역할에 최적화되어 있습니다.\n\n[추천 분야] 교수, 연구원, 작가, 전문 자격증(약사, 회계사 등), 컨설턴트, 기획자 등 **지적 재산권을 활용하거나 전문 지식으로 승부하는 분야**에서 독보적인 위치에 오릅니다.";
  } else {
    workLuck =
      "[리더십] 누구의 간섭도 받지 않고 독자적으로 결정하는 '오너형 리더'입니다. 남 밑에 있기보다는 작더라도 내 가게, 내 사업을 해야 직성이 풀립니다.\n\n[추천 분야] 프리랜서, 1인 창업, 유통업, 영업직 등 **자신의 노력과 성과가 비례하여 보상이 주어지는 구조**가 가장 큰 동기부여가 됩니다.";
  }

  // (5.2) 성공을 위한 팁 (Kick)
  if (shinsalList.includes('역마')) {
    workLuck +=
      "\n\n🚀 [성공 치트키] 당신의 재물은 '길 위'에 있습니다. 사무실에 앉아있지 말고 밖으로 나가세요. 잦은 출장, 해외 파견, 무역, 운수업 등 활동 반경을 넓힐수록 운의 크기도 커집니다.";
  }
  workLuck +=
    "\n\n💡 한 가지 분야를 10년 이상 파고드는 '장인 정신'이 필요합니다. 이것저것 손대기보다는 당신만의 킬러 콘텐츠 하나를 만드는 데 집중하세요.";

  // =================================================================
  // 6. 건강운 (취약 장기, 라이프스타일 처방전)
  // =================================================================
  let healthLuck = '';

  // (6.1) 장기 디테일 체크
  const weakParts = [];
  if (distributions?.WOOD?.count === 0) weakParts.push('간(피로), 담보, 신경통, 목/허리 디스크');
  if (distributions?.FIRE?.count === 0) weakParts.push('심장(순환), 소장, 시력 저하, 저혈압');
  if (distributions?.EARTH?.count === 0) weakParts.push('위장병, 소화불량, 피부 트러블, 비만');
  if (distributions?.METAL?.count === 0)
    weakParts.push('폐/기관지(호흡기), 대장(변비), 치아, 관절염');
  if (distributions?.WATER?.count === 0)
    weakParts.push('신장/방광(붓기), 생식기, 호르몬 불균형, 이명');

  if (weakParts.length > 0) {
    healthLuck = `[주의보] 당신의 사주에서 가장 취약한 고리는 **[${weakParts.join(', ')}]**입니다. 젊을 때는 모르고 지나갈 수 있으나, 나이가 들면 반드시 이 부분에서 신호가 옵니다. 미리 보험을 들어두거나 정기 검진을 놓치지 마세요.`;
  } else {
    healthLuck =
      "[축복] 오행의 기운이 골고루 순환하여 타고난 '건강 체질'입니다. 잔병치레가 적고 회복력이 빠릅니다. 하지만 자신의 건강을 과신하여 술 담배를 즐기거나 무리하다가는 한순간에 훅 갈 수 있으니, '있을 때 잘해'라는 말을 몸소 실천하세요.";
  }

  // (6.2) 멘탈 & 라이프스타일 처방
  if (distributions?.WATER?.count >= 3) {
    healthLuck +=
      '\n\n🍲 [처방전] 생각이 너무 많아 불면증이나 우울감이 오기 쉽습니다. 몸을 따뜻하게 하는 생강차나 인삼을 즐기시고, 햇볕을 보며 땀 흘리는 격한 운동(러닝, 등산)이 정신 건강 최고의 보약입니다.';
  } else if (distributions?.FIRE?.count >= 3) {
    healthLuck +=
      '\n\n🍲 [처방전] 화가 많아 혈압이 오르거나 심장이 두근거릴 수 있습니다. 쓴맛이 나는 나물이나 시원한 성질의 음식(오이, 메밀)이 좋습니다. 명상이나 요가로 들끓는 마음을 가라앉히는 습관을 들이세요.';
  } else {
    healthLuck +=
      '\n\n🍲 [처방전] 하루 7시간 이상의 충분한 수면과 하루 2L 물 마시기만 지켜도 당신의 활력은 배가 될 것입니다. 스트레스는 만병의 근원임을 잊지 말고, 나만의 해소법(취미)을 꼭 만드세요.';
  }

  return {
    summary: character,
    money: moneyLuck,
    love: loveLuck,
    marriage: marriageLuck,
    work: workLuck,
    health: healthLuck,
  };
}
